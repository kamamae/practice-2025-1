# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –æ—Å–Ω–æ–≤–Ω–æ–π –≤–µ—Ä—Å–∏–∏


–î–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã **–∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏**.

``` python
import logging
from aiogram import Bot, Dispatcher, types
from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton, CallbackQuery
from aiogram.filters import Command
from aiogram.utils.keyboard import InlineKeyboardBuilder
import asyncio
from aiogram.exceptions import TelegramBadRequest
from dotenv import load_dotenv
import os
```
**aiogram** - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è Telegram –±–æ—Ç–æ–≤, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∏–π:
___

``` python
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞
bot = Bot(token=API_TOKEN)
dp = Dispatcher()
```
- –ö–ª–∞—Å—Å—ã `Bot` –∏ `Dispatcher` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- –°–∏—Å—Ç–µ–º—É —Ñ–∏–ª—å—Ç—Ä–æ–≤ (`Command`, `Text` –∏ –¥—Ä.)
- –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–ª–∞–≤–∏–∞—Ç—É—Ä

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –±–æ—Ç–∞ –º—ã –ø–æ–ø–∞–¥–∞–µ–º –≤ –∫–∞—Ç–∞–ª–æ–≥.

``` python
async def show_main_menu(chat_id: int, message_id: int = None):
    builder = InlineKeyboardBuilder()
    builder.row(
        InlineKeyboardButton(text="üëï –§—É—Ç–±–æ–ª–∫–∏", callback_data="category_t-shirts"),
        InlineKeyboardButton(text="üß• –õ–æ–Ω–≥—Å–ª–∏–≤—ã", callback_data="category_hoodies")
    )
    builder.row(
        InlineKeyboardButton(text="üõí –ö–æ—Ä–∑–∏–Ω–∞", callback_data="view_cart"),
        InlineKeyboardButton(text="‚ÑπÔ∏è –û –º–∞–≥–∞–∑–∏–Ω–µ", callback_data="about")
    )

    text = "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –Ω–∞—à –º–∞–≥–∞–∑–∏–Ω –æ–¥–µ–∂–¥—ã! –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é:"

    try:
        if message_id:
            await bot.edit_message_text(
                chat_id=chat_id,
                message_id=message_id,
                text=text,
                reply_markup=builder.as_markup()
            )
        else:
            await bot.send_photo(
                chat_id=chat_id,
                photo="https://avatars.dzeninfra.ru/get-zen_doc/271828/pub_666c3d5dbdac467014320755_666c426761a30954faafcb95/scale_1200",
                caption=text,
                reply_markup=builder.as_markup()
            )
    except TelegramBadRequest as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é: {e}")
        await bot.send_message(chat_id, text, reply_markup=builder.as_markup())
```
![–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ](image/01.png)

### 2. –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

``` python
@dp.callback_query(lambda c: c.data.startswith('category_'))
async def process_category(callback_query: CallbackQuery):
    try:
        category = callback_query.data.split('_')[1]
        category_data = products.get(category)

        if not category_data:
            await callback_query.answer("–ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
            return

        await safe_delete_message(callback_query.message.chat.id, callback_query.message.message_id)

        first_item = category_data['items'][0]
        await callback_query.message.answer_photo(
            photo=first_item['image_url'],
            caption=f"–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {category_data['name']}\n\n–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä:"
        )

        builder = InlineKeyboardBuilder()
        for item in category_data['items']:
            builder.row(InlineKeyboardButton(
                text=f"{item['name']} - {item['price']}‚ÇΩ",
                callback_data=f"item_{item['id']}"
            ))
        builder.row(InlineKeyboardButton(text="‚¨ÖÔ∏è –ù–∞–∑–∞–¥", callback_data="main_menu"))

        await callback_query.message.answer(
            text="–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã:",
            reply_markup=builder.as_markup()
        )

    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –≤ process_category: {e}")
        await callback_query.answer("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ")
```
![–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ](image/02.png)

### 3. –ö–æ—Ä–∑–∏–Ω–∞

–ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ç–æ–≤–∞—Ä–∞ –º–æ–∂–Ω–æ –ª–∏–±–æ –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑, –ª–∏–±–æ –æ—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É –¥–ª—è –Ω–æ–≤–æ–≥–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è.

#### 3.2 –û—á–∏—â–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω—ã

```python
@dp.callback_query(lambda c: c.data.startswith('add_'))
async def add_to_cart(callback_query: CallbackQuery):
    try:
        _, item_id, size = callback_query.data.split('_')
        item_id = int(item_id)

        item = None
        for category in products.values():
            for product in category['items']:
                if product['id'] == item_id:
                    item = product
                    break
            if item:
                break

        if not item:
            await callback_query.answer("–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω")
            return

        user_id = callback_query.from_user.id
        if user_id not in user_carts:
            user_carts[user_id] = []

        user_carts[user_id].append({
            "id": item['id'],
            "name": item['name'],
            "price": item['price'],
            "size": size,
            "image": item['image_url']
        })

        await callback_query.answer(f"–î–æ–±–∞–≤–ª–µ–Ω–æ: {item['name']} (—Ä–∞–∑–º–µ—Ä {size})")

    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –≤ add_to_cart: {e}")
        await callback_query.answer("–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É")

```
![–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ](image/04.png)

#### 3.2 –û—á–∏—â–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω—ã

``` python
@dp.callback_query(lambda c: c.data == "clear_cart")
async def clear_cart(callback_query: CallbackQuery):
    try:
        user_id = callback_query.from_user.id
        if user_id in user_carts:
            del user_carts[user_id]
        await callback_query.answer("–ö–æ—Ä–∑–∏–Ω–∞ –æ—á–∏—â–µ–Ω–∞")
        await show_main_menu(callback_query.message.chat.id, callback_query.message.message_id)
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –≤ clear_cart: {e}")
        await callback_query.answer("–ù–µ —É–¥–∞–ª–æ—Å—å –æ—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É")

```
![–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ](image/07.png)
